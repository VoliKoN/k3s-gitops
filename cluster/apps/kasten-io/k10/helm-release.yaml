---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: k10
  namespace: kasten-io
spec:
  releaseName: k10
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://charts.kasten.io/
      chart: k10
      version: 4.0.8
      sourceRef:
        kind: HelmRepository
        name: kasten-charts
        namespace: flux-system
      interval: 5m
  values:
    eula:
      accept: true
      company: Devbu
      email: "${SECRET_EMAIL}"
    global:
      persistence:
        storageClass: rook-ceph-block
    auth:
      tokenAuth:
        enabled: true
    clusterName: k8s
    ingress:
      annotations:
        forecastle.stakater.com/expose: "true"
        forecastle.stakater.com/icon: "https://mp.s81c.com/pwb-production/c4a833f11e311146a23c643651068b75/k10-platform-logo-vertical-black-01-4d612e94-9053-4d14-a3c5-e4470582b282_6308f437-e24f-49c1-a8ee-a9034c82dcc0.png"
        forecastle.stakater.com/network-restricted: "true"
      create: true
      host: "k10.${SECRET_DOMAIN}"
      urlPath: k10
      hosts:
      - "k10.${SECRET_DOMAIN}"
      tls:
        enabled: true
        secretName: "${SECRET_DOMAIN/./-}-tls"
  # postRenderers:
  # - kustomize:
  #     patchesJson6902:
  #     - target:
  #         kind: Ingress
  #         name: k10-ingress
  #       patch:
  #       - op: add
  #         path: /spec/ingressClassName
  #         value: traefik
